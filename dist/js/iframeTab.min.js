!function(){iframeTab=jQuery.prototype={iframeHeight:function(e){var a=$(".active iframe")[0],t=$(document).frames?$(document).frames.iframepage.document:a.contentDocument;e?a.height=e:null!=a&&null!=t&&(a.height=t.body.scrollHeight)},init:function(option){var _tab=this,tab=_tab.prototype,tnum=0,p=window.parent.document,options=$.extend({tabLiClass:"",tabPanClass:"",closesBtnClass:"fa fa-close",switchBtnDown:"fa fa-chevron-down",switchBtnUp:"fa fa-chevron-up",contextmenuClass:"dropdown open",iframeBox:'<div class="right_col" role="main"></div>',singleLineheight:92,menuWidth:230,callback:""},option),tabLiClass=options.tabLiClass,tabPanClass=options.tabPanClass,closesBtnClass=options.closesBtnClass,switchBtnDown=options.switchBtnDown,switchBtnUp=options.switchBtnUp,iframeBox=options.iframeBox,singleLineheight=options.singleLineheight,menuWidth=options.menuWidth,contextmenuClass=options.contextmenuClass,callback=options.callback;if($.extend({stellung:function(e){var a=$(this),t=a.attr("href"),n=a.attr("data-name")?a.data("name"):a.text(),o=a.data("mul"),c=a.data("reload"),i=$(".tabs-header ul",p),l=$(".tabs-header li",p),r=$(".tabs-body",p),s=$(".tab-panel",p),d=i.find('li[data-name="'+n+'"]').data("tab"),b=$('<iframe src="'+t+'" data-iframe="'+t+'" data-num="'+tnum+'" marginheight="0" marginwidth="0" frameborder="0" scrolling="no" onLoad="iframeTab.iframeHeight()" name="'+tnum+'"></iframe>');a.on("click",function(e){e.preventDefault(),e.stopPropagation()});var f=function(e){var a,o,c,d=i.width();return c=e.beforeCreat(),c!==!1&&(l.removeClass("active"),i.append('<li class="active '+tabLiClass+'" data-tab="'+t+'" data-name="'+n+'" data-num="'+tnum+'">'+n+'<i class="'+closesBtnClass+'" data-btn="close"></i></li>'),!$('.tabs-header [data-btn="switch"]').length&&i.height()>singleLineheight?(a=i.find("li:last-child"),i.width(d-30),i.addClass("hide-tab"),i.after('<i class="'+switchBtnDown+' fold-switch" data-btn="switch"></i>'),$(document).on("click.tab.switch",'.tabs-header [data-btn="switch"]',function(){var e=$(this);e.toggleClass(switchBtnDown),e.toggleClass(switchBtnUp),i.toggleClass("hide-tab")}),a.remove(),i.find("li:first-child").before(a)):$('.tabs-header [data-btn="switch"]').length&&(o=i.find("li:last-child"),o.remove(),i.find("li:first-child").before(o)),s.removeClass("active"),r.append(b),b.wrap('<div class="tab-panel active '+tabPanClass+'"></div>'),b.wrap(iframeBox),e.onCreat(),$(b).load(function(){e.afterCreat()}),void(tnum+=1))};if(1===e.which){var h={beforeCreat:function(){if(callback.beforeCreat)return callback.beforeCreat()},onCreat:function(){callback.onCreat&&callback.onCreat()},afterCreat:function(){callback.afterCreat&&callback.afterCreat()}};$('.tabs-header li[data-name="'+n+'"]',p).length>0&&"undefined"==typeof o?!$('.tabs-header li[data-tab="'+t+'"]',p).length>0?(i.find('li[data-name="'+n+'"]').remove(),r.find('iframe[data-iframe="'+d+'"]').remove(),f(h)):(l.removeClass("active"),i.find('li[data-tab="'+t+'"]').addClass("active"),s.removeClass("active"),r.find('iframe[data-iframe="'+t+'"]').parents(".tab-panel").addClass("active"),"ja"===c&&r.find('iframe[data-iframe="'+t+'"]').attr("src",t)):f(h)}},btnDel:function(e){$(document).on("click.tab.close",'.tabs-header li [data-btn="close"]',function(a){var t,n=$(this),o=n.parent(),c=o.data("tab"),i=o.data("num"),l=$(".tabs-header ul"),r=$(".tabs-header li"),s=$(".tabs-body"),d=o.prev(),b=o.next(),f=$(window).width(),h=0;return t=e.beforeClose(),t!==!1&&(o.remove(),s.find('iframe[data-iframe="'+c+'"][data-num="'+i+'"]').parents(".tab-panel").remove(),r.each(function(){var e=$(this),a=e.width()>0?e.width()+25:e.width();h+=a}),$('.tabs-header [data-btn="switch"]').length&&h<f-menuWidth&&($(".tabs-header").find('[data-btn="switch"]').remove(),$(document).off("click.tab.switch"),l.toggleClass("hide-tab"),l.width("auto")),e.onClose(),"undefined"==typeof d.html()?b.click():d.click(),a.preventDefault(),a.stopPropagation(),void e.afterClose())})},changeTab:function(e){$(document).on("click.tab.change",".tabs-header li:not(.active)",function(){var a,t=$(this),n=t.data("tab"),o=t.data("num"),c=$(".tabs-header ul"),i=$(".tabs-header li"),l=$(".tabs-body"),r=$(".tab-panel"),s=l.find('iframe[data-iframe="'+n+'"][data-num="'+o+'"]');return a=e.beforeChange(),a!==!1&&(i.removeClass("active"),r.removeClass("active"),e.onChange(),c.find('li[data-tab="'+n+'"][data-num="'+o+'"]').addClass("active"),s.parents(".tab-panel").addClass("active"),void e.afterChange())})},creatContextmenu:function(e){var a=$(this),t=e.clientX,n=e.clientY,o=window.innerWidth,c='<div class="tab-contextmenu '+contextmenuClass+'" style="top: '+n+'px"><ul class="dropdown-menu"><li><a href="javascript: void(0)" data-btn="removeAll">关闭所有标签</a></li><li><a href="javascript: void(0)" data-btn="removeExceptAct">关闭激活标签外所有标签</a></li></ul></div>',i=180;3===e.which&&(a.on("contextmenu",function(e){e.preventDefault()}),$(".tab-contextmenu").length&&$(".tab-contextmenu").remove(),$("body").before(c),o-t>i?$(".tab-contextmenu").css("left",t):$(".tab-contextmenu").css("right",i),$(document).on("click.context.remove.pl",'[data-btn="removeAll"]',function(){$(".tabs-header li:not(.tab-keep)").remove(),$(".tab-panel:not(.tab-keep)").remove(),$(".tabs-header li.tab-keep").click()}),$(document).on("click.context.remove.sing",'[data-btn="removeExceptAct"]',function(){$(".tabs-header li, .tab-panel").each(function(){var e=$(this);e.is(":not(.tab-keep)")&&e.is(":not(.active)")&&e.remove()}),$(".tabs-header li.active").click()}),$("body").on("click.hide.context",function(){$("body").off("click.hide.context"),$(".tab-contextmenu").remove(),$(document).off("click.context.remove.pl",'[data-btn="removeAll"]').off("click.context.remove.sing",'[data-btn="removeExceptAct"]')}),$(".tab-panel.active iframe")[0].contentWindow.$("body").on("click.hide.context",function(){$(".tab-panel.active iframe")[0].contentWindow.$("body").off("click.hide.context"),parent.$(".tab-contextmenu").remove(),parent.$(document).off("click.context.remove.pl",'[data-btn="removeAll"]').off("click.context.remove.sing",'[data-btn="removeExceptAct"]')}))}}),$("[data-source]").length&&$(document).on("mouseup","[data-source]",function(){var e=$(this),a=e.data("source"),t=$(".tabs-body",p);t.find('iframe[src="'+a+'"]').attr("src",a),iframeTab.iframeHeight()}),$(document).on("mouseup","a[data-num]",$.stellung),1===$(".tabs-header li",p).length){var changeCb={beforeChange:function(){if(callback.beforeChange)return callback.beforeChange()},onChange:function(){callback.onChange&&callback.onChange()},afterChange:function(){callback.afterChange&&callback.afterChange()}},closeCb={beforeClose:function(){if(callback.beforeClose)return callback.beforeClose()},onClose:function(){callback.onClose&&callback.onClose()},afterClose:function(){callback.afterClose&&callback.afterClose()}};$.changeTab(changeCb),$.btnDel(closeCb)}return $(".tabs-header").on("mousedown",$.creatContextmenu),$(document).on("click",'[data-btn="refresh"]',function(){window.location.reload(!0)}),tab={on:function(e,a){var t=e;switch(t){case"beforeCreat":callback={beforeCreat:a};break;case"onCreat":callback={onCreat:a};break;case"afterCreat":callback={afterCreat:a};break;case"beforeChange":callback={beforeChange:a};break;case"onChange":callback={onChange:a};break;case"afterChange":callback={afterChange:a};break;case"beforeClose":callback={beforeClose:a};break;case"onClose":callback={onClose:a};break;case"afterClose":callback={afterClose:a}}},closeActIframe:function(){parent.$('.tabs-header li.active [data-btn="close"]').click()},destroy:function(){$(document).off("mouseup","a[data-num]").off("click.tab.change",".tabs-header li:not(.active)").off("click.tab.close",'.tabs-header li [data-btn="close"]').off("click",'[data-btn="refresh"]'),$(".tabs-header").off("mousedown"),delete tab.on,delete tab.closeActIframe,delete tab.destroy,delete tab.constructor},dispose:function(refName){$(document).off("mouseup","a[data-num]").off("click.tab.change",".tabs-header li:not(.active)").off("click.tab.close",'.tabs-header li [data-btn="close"]').off("click",'[data-btn="refresh"]'),$(".tabs-header").off("mousedown"),eval(refName+" = null;"),eval("delete "+refName+";")}}}}}();