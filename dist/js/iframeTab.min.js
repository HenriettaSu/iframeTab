!function(){iframeTab=jQuery.prototype={iframeHeight:function(t){var e,a,n,i,o=document.getElementById("tabBody").children,c=document.frames?document.frames.length-1:0;for(n=0;n<o.length;n++){var l;i=o[n],l=i.getAttribute("class"),e=l.match("active")?i.getElementsByTagName("iframe")[0]:null}a=document.frames?document.frames[c].document:e.contentDocument,t?e.height=t:null!==e&&null!==a&&(e.height=a.body.scrollHeight),$(document).trigger("iframetab.reloaded")},init:function(option){function stellung(t){function e(t){var e,i,o,l=$tabUl.width();return o=t.beforeCreat(),o!==!1&&(tabList[c]=!0,d.removeClass(act),$tabUl.append(a),!isSwitch&&$tabUl.height()>singleLineheight?(e=$tabUl.find("li").last(),$tabUl.width(l-30),$tabUl.addClass("hide-tab"),$tabUl.after('<i class="'+switchBtnDown+' fold-switch" data-btn="switch"></i>'),isSwitch=!0,$("#tabHeader").on("click.iframetab.switch",'[data-btn="switch"]',function(){var t=$(this);t.toggleClass(switchBtnDown),t.toggleClass(switchBtnUp),$tabUl.toggleClass("hide-tab")}),e.remove(),$tabUl.find("li").first().before(e)):isSwitch&&(i=$tabUl.find("li").last(),i.remove(),$tabUl.find("li").first().before(i)),b.removeClass(act),$tabBody.append(n),n.wrap('<div class="tab-panel active '+tabPanClass+'" data-num="'+r+'"  data-iframe="'+c+'"></div>'),n.wrap(iframeBox),t.onCreat(),void n.load(function(){t.afterCreat()}))}var a,n,i=$(this),o=this,c=o.href,l=getData(o,"name")?getData(o,"name"):o.innerHTML,r=(new Date).getTime(),s=getData(o,"mul"),f=getData(o,"reload"),d=$("#tabHeader li",p),b=$(".tab-panel",p),m=($tabUl.find('li[data-name="'+l+'"]').data("tab"),[]),u=[];if(m.push('<li class="active ',tabLiClass,'" data-tab="',c,'" data-name="',l,'" data-num="',r,'">',l,'<i class="',closesBtnClass,'" data-btn="close"></i></li>'),a=m.join(""),u.push('<iframe src="',c,'" marginheight="0" marginwidth="0" frameborder="0" scrolling="no" onLoad="iframeTab.iframeHeight()"></iframe>'),n=$(u.join("")),i.on("click",function(t){t.preventDefault(),t.stopPropagation()}),1===t.which){var h={beforeCreat:function(){if(callback.beforeCreat)return callback.beforeCreat()},onCreat:function(){callback.onCreat&&callback.onCreat()},afterCreat:function(){callback.afterCreat&&callback.afterCreat()}};tabList[c]&&"undefined"==typeof s?(d.removeClass(act),$tabUl.find('li[data-tab="'+c+'"]').addClass(act),b.removeClass(act),$tabBody.find('[data-iframe="'+c+'"]').addClass(act),f&&$tabBody.find('[data-iframe="'+c+'"]').find("iframe").attr("src",c)):e(h)}}function changeTab(t){$("#tabHeader").on("click.iframetab","li:not(.active)",function(){var e,a=($(this),this),n=(getData(a,"tab"),getData(a,"num")),i=$(".tab-panel"),o=$tabUl.find("li");return e=t.beforeChange(),e!==!1&&(o.removeClass(act),i.removeClass(act),t.onChange(),$('[data-num="'+n+'"]').addClass(act),void t.afterChange())})}function btnDel(t){$("#tabHeader").on("click.iframetab",'li [data-btn="close"]',function(e){var a,n,i,o,c=($(this),this.parentNode),l=c.previousElementSibling,r=c.nextElementSibling,s=getData(c,"tab"),f=getData(c,"num"),d=document.getElementById("tabHeader").getElementsByTagName("li"),b=document.body.clientWidth,m=0;if(n=t.beforeClose(),n===!1)return!1;for(delete tabList[s],$('[data-num="'+f+'"]').remove(),i=0;i<d.length;i++)o=d[i],a=o.offsetWidth>0?o.offsetWidth:o.offsetWidth,m+=a;isSwitch&&m<b-menuWidth&&($("#tabHeader").off("click.iframetab.switch").find('[data-btn="switch"]').remove(),isSwitch=!1,$tabUl.removeClass("hide-tab"),$tabUl.width("auto")),t.onClose(),l?l.click():r.click(),e.preventDefault(),e.stopPropagation(),t.afterClose()})}function creatContextmenu(t){var e,a,n=$(this),i=t.clientX,o=t.clientY,c=window.innerWidth,l=[],r=0;l.push('<div id="tabContextmenu" class="tab-contextmenu ',contextmenuClass,'"><ul class="dropdown-menu"><li><a href="javascript: void(0)" data-btn="removeAll">关闭所有标签</a></li><li><a href="javascript: void(0)" data-btn="removeExceptAct">关闭激活标签外所有标签</a></li></ul></div>'),a=l.join(""),3===t.which&&(n.on("contextmenu",function(t){t.preventDefault()}),isOpen?$("#tabContextmenu").addClass("open"):($("body").after(a),isOpen=!0),e=document.getElementById("tabContextmenu"),r=e.scrollWidth+6,c-i>r?e.style.left=i+"px":(e.style.right=r+"px",e.style.left="auto"),e.style.top=o+"px",$(document).on("click.context.remove.pl",'[data-btn="removeAll"]',function(){$("#tabHeader").find("li:not(.tab-keep)").remove(),$(".tab-panel:not(.tab-keep)").remove(),$("#tabHeader").find("li.tab-keep").click(),isSwitch&&($("#tabHeader").off("click.iframetab.switch").find('[data-btn="switch"]').remove(),$tabUl.removeClass("hide-tab"),$tabUl.width("auto"),isSwitch=!1),tabList={}}),$(document).on("click.context.remove.sing",'[data-btn="removeExceptAct"]',function(){$("#tabHeader li, .tab-panel").each(function(){var t=$(this),e=getData(this,"tab");t.is(":not(.tab-keep)")&&t.is(":not(.active)")&&(t.remove(),delete tabList[e])}),$("#tabHeader").find("li.active").click(),isSwitch&&($("#tabHeader").off("click.iframetab.switch").find('[data-btn="switch"]').remove(),$tabUl.removeClass("hide-tab"),$tabUl.width("auto"),isSwitch=!1)}),$("body").on("click.hide.context",function(){$("body").off("click.hide.context"),$("#tabContextmenu").removeClass("open"),$(document).off("click.context.remove.pl",'[data-btn="removeAll"]').off("click.context.remove.sing",'[data-btn="removeExceptAct"]')}),$(".tab-panel.active iframe")[0].contentWindow.$("body").on("click.hide.context",function(){$(".tab-panel.active iframe")[0].contentWindow.$("body").off("click.hide.context"),parent.$("#tabContextmenu").removeClass("open"),parent.$(document).off("click.context.remove.pl",'[data-btn="removeAll"]').off("click.context.remove.sing",'[data-btn="removeExceptAct"]')}))}function checkResize(){$(window).resize(function(){var t=window.innerHeight,e=window.innerWidth;currHei&&currHei===t&&currWid&&currWid===e||(parent.iframeTab.iframeHeight(),currHei=t,currWid=e)})}function offEvents(){$(document).off("mouseup.iframetab").off("click.iframetab").off("iframetab.reloaded"),$("#tabHeader").off("mousedown.iframetab").off("click.iframetab")}function testArry(t){return Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Array.isArray(t)?"array":typeof t}function getData(t,e){var a=t.dataset?t.dataset[e]:t.getAttribute("data-"+e);return a}var _tab=this,tab=_tab.prototype,act="active",isTop=top===self,isOpen=!1,isSwitch=!1,p=isTop?null:window.parent.document,$tabUl=$("#tabHeader ul",p),$tabBody=$("#tabBody",p),currHei,currWid,options=$.extend({tabLiClass:"",tabPanClass:"",closesBtnClass:"fa fa-close",switchBtnDown:"fa fa-chevron-down",switchBtnUp:"fa fa-chevron-up",contextmenuClass:"dropdown",iframeBox:'<div class="right_col" role="main"></div>',singleLineheight:document.getElementById("tabHeader")?document.getElementById("tabHeader").scrollHeight:0,menuWidth:document.getElementById("leftMenu")?document.getElementById("leftMenu").scrollWidth:0,callback:[]},option),tabLiClass=options.tabLiClass,tabPanClass=options.tabPanClass,closesBtnClass=options.closesBtnClass,switchBtnDown=options.switchBtnDown,switchBtnUp=options.switchBtnUp,iframeBox=options.iframeBox,singleLineheight=options.singleLineheight,menuWidth=options.menuWidth,contextmenuClass=options.contextmenuClass,callback=options.callback;if(tabList=parent.tabList||{},$(document).on("iframetab.reloaded",checkResize),$(document).on("mouseup.iframetab","a[data-num]",stellung),isTop){var changeCb={beforeChange:function(){if(callback.beforeChange)return callback.beforeChange()},onChange:function(){callback.onChange&&callback.onChange()},afterChange:function(){callback.afterChange&&callback.afterChange()}},closeCb={beforeClose:function(){if(callback.beforeClose)return callback.beforeClose()},onClose:function(){callback.onClose&&callback.onClose()},afterClose:function(){callback.afterClose&&callback.afterClose()}};changeTab(changeCb),btnDel(closeCb),$("#tabHeader").on("mousedown.iframetab",creatContextmenu)}return $("[data-source]").length&&$(document).on("mouseup.iframetab","[data-source]",function(){var t=getData(this,"source");$tabBody.find('iframe[src="'+t+'"]').attr("src",t),iframeTab.iframeHeight()}),$('[data-btn="refresh"]').length&&$(document).on("click.iframetab",'[data-btn="refresh"]',function(t){t.preventDefault(),t.stopPropagation(),window.location.reload(!0)}),tab={on:function(){var t,e,a,n=arguments.length,i=arguments[0],o=arguments[1],c=testArry(i);switch(c){case"string":for(t=i.split(" "),e=0;e<n;e++)a=t[e],callback[a]=o;break;case"object":for(e in i)callback[e]=i[e];break;default:console.error("Event type is unexceptable.")}},off:function(t){var e,a,n,i,o=t,c=typeof o,l=!1;switch(c){case"string":if(l=" "!==o)if(e=o.split(" "),a=e.length,1===a)delete callback[o];else for(n=0;n<a;n++)i=e[n],delete callback[i];break;case"undefined":for(n in callback)delete callback[n]}},closeActIframe:function(){parent.$("#tabHeader").find("li.active").find('[data-btn="close"]').click()},destroy:function(){var t;offEvents();for(t in tab)"dispose"!==t&&delete tab[t]},dispose:function(refName){offEvents(),eval(refName+" = null;"),eval("delete "+refName+";")}}}}}();