!function(){iframeTab=jQuery.prototype={iframeHeight:function(a){var t=$(".active iframe")[0],e=$(document).frames?$(document).frames.iframepage.document:t.contentDocument;a?t.height=a:null!==t&&null!==e&&(t.height=e.body.scrollHeight)},init:function(option){function stellung(a){function t(a){var t,e,i,o=$tabUl.width();return i=a.beforeCreat(),i!==!1&&(tabList[n]=!0,s.removeClass(act),$tabUl.append(f),!isSwitch&&$tabUl.height()>singleLineheight?(t=$tabUl.find("li:last-child"),$tabUl.width(o-30),$tabUl.addClass("hide-tab"),$tabUl.after('<i class="'+switchBtnDown+' fold-switch" data-btn="switch"></i>'),isSwitch=!0,$(".tabs-header").on("click.iframetab.switch",'[data-btn="switch"]',function(){var a=$(this);a.toggleClass(switchBtnDown),a.toggleClass(switchBtnUp),$tabUl.toggleClass("hide-tab")}),t.remove(),$tabUl.find("li:first-child").before(t)):isSwitch&&(e=$tabUl.find("li:last-child"),e.remove(),$tabUl.find("li:first-child").before(e)),r.removeClass(act),$tabBody.append(b),b.wrap('<div class="tab-panel active '+tabPanClass+'"></div>'),b.wrap(iframeBox),a.onCreat(),void b.load(function(){a.afterCreat()}))}var e=$(this),n=e.attr("href"),i=e.attr("data-name")?e.data("name"):e.text(),o=(new Date).getTime(),c=e.data("mul"),l=e.data("reload"),s=$(".tabs-header li",p),r=$(".tab-panel",p),f=($tabUl.find('li[data-name="'+i+'"]').data("tab"),'<li class="active '+tabLiClass+'" data-tab="'+n+'" data-name="'+i+'" data-num="'+o+'">'+i+'<i class="'+closesBtnClass+'" data-btn="close"></i></li>'),b=$('<iframe src="'+n+'" data-iframe="'+n+'" data-num="'+o+'" marginheight="0" marginwidth="0" frameborder="0" scrolling="no" onLoad="iframeTab.iframeHeight()" name="'+o+'"></iframe>');if(e.on("click",function(a){a.preventDefault(),a.stopPropagation()}),1===a.which){var d={beforeCreat:function(){if(callback.beforeCreat)return callback.beforeCreat()},onCreat:function(){callback.onCreat&&callback.onCreat()},afterCreat:function(){callback.afterCreat&&callback.afterCreat()}};tabList[n]&&"undefined"==typeof c?(s.removeClass(act),$tabUl.find('li[data-tab="'+n+'"]').addClass("active"),r.removeClass(act),$tabBody.find('iframe[data-iframe="'+n+'"]').parents(".tab-panel").addClass(act),l&&$tabBody.find('iframe[data-iframe="'+n+'"]').attr("src",n)):t(d)}}function changeTab(a){$(".tabs-header").on("click.iframetab","li:not(.active)",function(){var t,e=$(this),n=e.data("tab"),i=e.data("num"),o=$(".tabs-header ul"),c=$(".tabs-header li"),l=$(".tabs-body"),s=$(".tab-panel"),r=l.find('iframe[data-iframe="'+n+'"][data-num="'+i+'"]');return t=a.beforeChange(),t!==!1&&(c.removeClass(act),s.removeClass(act),a.onChange(),o.find('li[data-tab="'+n+'"][data-num="'+i+'"]').addClass(act),r.parents(".tab-panel").addClass(act),void a.afterChange())})}function btnDel(a){$(".tabs-header").on("click.iframetab",'li [data-btn="close"]',function(t){var e,n=$(this),i=n.parent(),o=i.data("tab"),c=i.data("num"),l=$(".tabs-header li"),s=i.prev(),r=i.next(),f=$(window).width(),b=0;return e=a.beforeClose(),e!==!1&&(delete tabList[o],i.remove(),$tabBody.find('iframe[data-iframe="'+o+'"][data-num="'+c+'"]').parents(".tab-panel").remove(),l.each(function(){var a=$(this),t=a.width()>0?a.width()+25:a.width();b+=t}),isSwitch&&b<f-menuWidth&&($(".tabs-header").off("click.iframetab.switch").find('[data-btn="switch"]').remove(),isSwitch=!1,$tabUl.toggleClass("hide-tab"),$tabUl.width("auto")),a.onClose(),"undefined"==typeof s.html()?r.click():s.click(),t.preventDefault(),t.stopPropagation(),void a.afterClose())})}function creatContextmenu(a){var t=$(this),e=a.clientX,n=a.clientY,i=window.innerWidth,o='<div class="tab-contextmenu '+contextmenuClass+'"><ul class="dropdown-menu"><li><a href="javascript: void(0)" data-btn="removeAll">关闭所有标签</a></li><li><a href="javascript: void(0)" data-btn="removeExceptAct">关闭激活标签外所有标签</a></li></ul></div>',c=180;3===a.which&&(t.on("contextmenu",function(a){a.preventDefault()}),isOpen?$(".tab-contextmenu").addClass("open"):($("body").after(o),isOpen=!0),i-e>c?$(".tab-contextmenu").css("left",e):$(".tab-contextmenu").css("right",c),$(".tab-contextmenu").css("top",n),$(document).on("click.context.remove.pl",'[data-btn="removeAll"]',function(){$(".tabs-header li:not(.tab-keep)").remove(),$(".tab-panel:not(.tab-keep)").remove(),$(".tabs-header li.tab-keep").click(),isSwitch&&($(".tabs-header").off("click.iframetab.switch").find('[data-btn="switch"]').remove(),$tabUl.removeClass("hide-tab"),$tabUl.width("auto"),isSwitch=!1),tabList={}}),$(document).on("click.context.remove.sing",'[data-btn="removeExceptAct"]',function(){$(".tabs-header li, .tab-panel").each(function(){var a=$(this),t=a.data("tab");a.is(":not(.tab-keep)")&&a.is(":not(.active)")&&(a.remove(),delete tabList[t])}),$(".tabs-header li.active").click(),isSwitch&&($(".tabs-header").off("click.iframetab.switch").find('[data-btn="switch"]').remove(),$tabUl.removeClass("hide-tab"),$tabUl.width("auto"),isSwitch=!1)}),$("body").on("click.hide.context",function(){$("body").off("click.hide.context"),$(".tab-contextmenu").removeClass("open"),$(document).off("click.context.remove.pl",'[data-btn="removeAll"]').off("click.context.remove.sing",'[data-btn="removeExceptAct"]')}),$(".tab-panel.active iframe")[0].contentWindow.$("body").on("click.hide.context",function(){$(".tab-panel.active iframe")[0].contentWindow.$("body").off("click.hide.context"),parent.$(".tab-contextmenu").removeClass("open"),parent.$(document).off("click.context.remove.pl",'[data-btn="removeAll"]').off("click.context.remove.sing",'[data-btn="removeExceptAct"]')}))}function offEvents(){$(document).off("mouseup.iframetab").off("click.iframetab"),$(".tabs-header").off("mousedown.iframetab").off("click.iframetab")}function testArry(a){return Array.isArray(a)?"array":typeof a}var _tab=this,tab=_tab.prototype,act="active",isTop=top===self,isOpen=!1,isSwitch=!1,p=isTop?null:window.parent.document,$tabUl=$(".tabs-header ul",p),$tabBody=$(".tabs-body",p),options=$.extend({tabLiClass:"",tabPanClass:"",closesBtnClass:"fa fa-close",switchBtnDown:"fa fa-chevron-down",switchBtnUp:"fa fa-chevron-up",contextmenuClass:"dropdown open",iframeBox:'<div class="right_col" role="main"></div>',singleLineheight:92,menuWidth:230,callback:[]},option),tabLiClass=options.tabLiClass,tabPanClass=options.tabPanClass,closesBtnClass=options.closesBtnClass,switchBtnDown=options.switchBtnDown,switchBtnUp=options.switchBtnUp,iframeBox=options.iframeBox,singleLineheight=options.singleLineheight,menuWidth=options.menuWidth,contextmenuClass=options.contextmenuClass,callback=options.callback;if(tabList=parent.tabList||{},$(window).resize(function(){parent.iframeTab.iframeHeight()}),$(document).on("mouseup.iframetab","a[data-num]",stellung),isTop){var changeCb={beforeChange:function(){if(callback.beforeChange)return callback.beforeChange()},onChange:function(){callback.onChange&&callback.onChange()},afterChange:function(){callback.afterChange&&callback.afterChange()}},closeCb={beforeClose:function(){if(callback.beforeClose)return callback.beforeClose()},onClose:function(){callback.onClose&&callback.onClose()},afterClose:function(){callback.afterClose&&callback.afterClose()}};changeTab(changeCb),btnDel(closeCb),$(".tabs-header").on("mousedown.iframetab",creatContextmenu)}return $("[data-source]").length&&$(document).on("mouseup.iframetab","[data-source]",function(){var a=$(this),t=a.data("source");$tabBody.find('iframe[src="'+t+'"]').attr("src",t),iframeTab.iframeHeight()}),$('[data-btn="refresh"]').length&&$(document).on("click.iframetab",'[data-btn="refresh"]',function(a){a.preventDefault(),a.stopPropagation(),window.location.reload(!0)}),tab={on:function(){var a,t,e,n=arguments.length,i=arguments[0],o=arguments[1],c=testArry(i);switch(c){case"string":for(a=i.split(" "),t=0;t<n;t++)e=a[t],callback[e]=o;break;case"object":for(t in i)callback[t]=i[t];break;default:console.error("Event type is unexceptable.")}},off:function(a){var t,e,n,i,o=a,c=typeof o,l=!1;switch(c){case"string":if(l=" "!==o)if(t=o.split(" "),e=t.length,1===e)delete callback[o];else for(n=0;n<e;n++)i=t[n],delete callback[i];break;case"undefined":for(n in callback)delete callback[n]}},closeActIframe:function(){parent.$('.tabs-header li.active [data-btn="close"]').click()},destroy:function(){var a;offEvents();for(a in tab)"dispose"!==a&&delete tab[a]},dispose:function(refName){offEvents(),eval(refName+" = null;"),eval("delete "+refName+";")}}}}}();