!function(){function changeTab(t){$(document).on("click.iframetab",".tabs-header li:not(.active)",function(){var e,a=$(this),n=a.data("tab"),i=a.data("num"),o=$(".tabs-header ul"),c=$(".tabs-header li"),r=$(".tabs-body"),s=$(".tab-panel"),l=r.find('iframe[data-iframe="'+n+'"][data-num="'+i+'"]');return e=t.beforeChange(),e!==!1&&(c.removeClass(act),s.removeClass(act),t.onChange(),o.find('li[data-tab="'+n+'"][data-num="'+i+'"]').addClass(act),l.parents(".tab-panel").addClass(act),void t.afterChange())})}function btnDel(t){$(document).on("click.iframetab",'.tabs-header li [data-btn="close"]',function(e){var a,n=$(this),i=n.parent(),o=i.data("tab"),c=i.data("num"),r=$(".tabs-header ul"),s=$(".tabs-header li"),l=$(".tabs-body"),f=i.prev(),d=i.next(),b=$(window).width(),m=0;return a=t.beforeClose(),a!==!1&&(delete tabList[o],i.remove(),l.find('iframe[data-iframe="'+o+'"][data-num="'+c+'"]').parents(".tab-panel").remove(),s.each(function(){var t=$(this),e=t.width()>0?t.width()+25:t.width();m+=e}),isSwitch&&m<b-menuWidth&&($(".tabs-header").find('[data-btn="switch"]').remove(),$(document).off("click.iframetab.switch"),isSwitch=!1,r.toggleClass("hide-tab"),r.width("auto")),t.onClose(),"undefined"==typeof f.html()?d.click():f.click(),e.preventDefault(),e.stopPropagation(),void t.afterClose())})}var p=window.parent.document,act="active",tabList={},isSwitch=!1;iframeTab=jQuery.prototype={iframeHeight:function(t){var e=$(".active iframe")[0],a=$(document).frames?$(document).frames.iframepage.document:e.contentDocument;t?e.height=t:null!=e&&null!=a&&(e.height=a.body.scrollHeight)},init:function(option){function stellung(t){function e(t){var e,a,o,c=r.width();return o=t.beforeCreat(),o!==!1&&(tabList[n]=!0,s.removeClass(act),r.append('<li class="active '+tabLiClass+'" data-tab="'+n+'" data-name="'+i+'" data-num="'+tnum+'">'+i+'<i class="'+closesBtnClass+'" data-btn="close"></i></li>'),isSwitch===!1&&r.height()>singleLineheight?(e=r.find("li:last-child"),r.width(c-30),r.addClass("hide-tab"),r.after('<i class="'+switchBtnDown+' fold-switch" data-btn="switch"></i>'),isSwitch=!0,$(document).on("click.iframetab.switch",'.tabs-header [data-btn="switch"]',function(){var t=$(this);t.toggleClass(switchBtnDown),t.toggleClass(switchBtnUp),r.toggleClass("hide-tab")}),e.remove(),r.find("li:first-child").before(e)):isSwitch&&(a=r.find("li:last-child"),a.remove(),r.find("li:first-child").before(a)),f.removeClass(act),l.append(d),d.wrap('<div class="tab-panel active '+tabPanClass+'"></div>'),d.wrap(iframeBox),t.onCreat(),$(d).load(function(){t.afterCreat()}),void(tnum+=1))}var a=$(this),n=a.attr("href"),i=a.attr("data-name")?a.data("name"):a.text(),o=a.data("mul"),c=a.data("reload"),r=$(".tabs-header ul",p),s=$(".tabs-header li",p),l=$(".tabs-body",p),f=$(".tab-panel",p),d=(r.find('li[data-name="'+i+'"]').data("tab"),$('<iframe src="'+n+'" data-iframe="'+n+'" data-num="'+tnum+'" marginheight="0" marginwidth="0" frameborder="0" scrolling="no" onLoad="iframeTab.iframeHeight()" name="'+tnum+'"></iframe>'));if(a.on("click",function(t){t.preventDefault(),t.stopPropagation()}),1===t.which){var b={beforeCreat:function(){if(callback.beforeCreat)return callback.beforeCreat()},onCreat:function(){callback.onCreat&&callback.onCreat()},afterCreat:function(){callback.afterCreat&&callback.afterCreat()}};tabList[n]&&"undefined"==typeof o?(s.removeClass(act),r.find('li[data-tab="'+n+'"]').addClass("active"),f.removeClass(act),l.find('iframe[data-iframe="'+n+'"]').parents(".tab-panel").addClass(act),c&&l.find('iframe[data-iframe="'+n+'"]').attr("src",n)):e(b)}}function creatContextmenu(t){var e=$(this),a=t.clientX,n=t.clientY,i=window.innerWidth,o='<div class="tab-contextmenu '+contextmenuClass+'" style="top: '+n+'px"><ul class="dropdown-menu"><li><a href="javascript: void(0)" data-btn="removeAll">关闭所有标签</a></li><li><a href="javascript: void(0)" data-btn="removeExceptAct">关闭激活标签外所有标签</a></li></ul></div>',c=180,r=$(".tabs-header ul");3===t.which&&(e.on("contextmenu",function(t){t.preventDefault()}),$(".tab-contextmenu").length&&$(".tab-contextmenu").remove(),$("body").before(o),i-a>c?$(".tab-contextmenu").css("left",a):$(".tab-contextmenu").css("right",c),$(document).on("click.context.remove.pl",'[data-btn="removeAll"]',function(){$(".tabs-header li:not(.tab-keep)").remove(),$(".tab-panel:not(.tab-keep)").remove(),$(".tabs-header li.tab-keep").click(),isSwitch&&($(".tabs-header").find('[data-btn="switch"]').remove(),$(document).off("click.iframetab.switch"),r.removeClass("hide-tab"),r.width("auto"),isSwitch=!1),tabList={}}),$(document).on("click.context.remove.sing",'[data-btn="removeExceptAct"]',function(){$(".tabs-header li, .tab-panel").each(function(){var t=$(this),e=t.data("tab");t.is(":not(.tab-keep)")&&t.is(":not(.active)")&&(t.remove(),delete tabList[e])}),$(".tabs-header li.active").click(),isSwitch&&($(".tabs-header").find('[data-btn="switch"]').remove(),$(document).off("click.iframetab.switch"),r.removeClass("hide-tab"),r.width("auto"),isSwitch=!1)}),$("body").on("click.hide.context",function(){$("body").off("click.hide.context"),$(".tab-contextmenu").remove(),$(document).off("click.context.remove.pl",'[data-btn="removeAll"]').off("click.context.remove.sing",'[data-btn="removeExceptAct"]')}),$(".tab-panel.active iframe")[0].contentWindow.$("body").on("click.hide.context",function(){$(".tab-panel.active iframe")[0].contentWindow.$("body").off("click.hide.context"),parent.$(".tab-contextmenu").remove(),parent.$(document).off("click.context.remove.pl",'[data-btn="removeAll"]').off("click.context.remove.sing",'[data-btn="removeExceptAct"]')}))}function offEvents(){$(document).off("mouseup.iframetab").off("click.iframetab"),$(".tabs-header").off("mousedown.iframetab")}function testArry(t){return Array.isArray(t)?"array":typeof t}var _tab=this,tab=_tab.prototype,tnum=0,options=$.extend({tabLiClass:"",tabPanClass:"",closesBtnClass:"fa fa-close",switchBtnDown:"fa fa-chevron-down",switchBtnUp:"fa fa-chevron-up",contextmenuClass:"dropdown open",iframeBox:'<div class="right_col" role="main"></div>',singleLineheight:92,menuWidth:230,callback:[]},option),tabLiClass=options.tabLiClass,tabPanClass=options.tabPanClass,closesBtnClass=options.closesBtnClass,switchBtnDown=options.switchBtnDown,switchBtnUp=options.switchBtnUp,iframeBox=options.iframeBox,singleLineheight=options.singleLineheight,menuWidth=options.menuWidth,contextmenuClass=options.contextmenuClass,callback=options.callback;if($(window).resize(function(){parent.iframeTab.iframeHeight()}),$(document).on("mouseup.iframetab","a[data-num]",stellung),top===self){var changeCb={beforeChange:function(){if(callback.beforeChange)return callback.beforeChange()},onChange:function(){callback.onChange&&callback.onChange()},afterChange:function(){callback.afterChange&&callback.afterChange()}},closeCb={beforeClose:function(){if(callback.beforeClose)return callback.beforeClose()},onClose:function(){callback.onClose&&callback.onClose()},afterClose:function(){callback.afterClose&&callback.afterClose()}};changeTab(changeCb),btnDel(closeCb),$(".tabs-header").on("mousedown.iframetab",creatContextmenu)}return $("[data-source]").length&&$(document).on("mouseup.iframetab","[data-source]",function(){var t=$(this),e=t.data("source"),a=$(".tabs-body",p);a.find('iframe[src="'+e+'"]').attr("src",e),iframeTab.iframeHeight()}),$('[data-btn="refresh"]').length&&$(document).on("click.iframetab",'[data-btn="refresh"]',function(t){t.preventDefault(),t.stopPropagation(),window.location.reload(!0)}),tab={on:function(t,e){var a,n,i,o=t,c=testArry(o);switch(c){case"string":for(a=o.split(" "),n=0;n<a.length;n++)i=a[n],callback[i]=e;break;case"object":for(n in o)callback[n]=o[n];break;default:console.error("Event type is unexceptable.")}},off:function(t){var e,a,n,i=t,o=typeof i;switch(o){case"string":for(e=i.split(" "),a=0;a<e.length;a++)n=e[a],delete callback[n];break;case"undefined":for(a in callback)delete callback[a]}},closeActIframe:function(){parent.$('.tabs-header li.active [data-btn="close"]').click()},destroy:function(){var t;offEvents();for(t in tab)"dispose"!==t&&delete tab[t]},dispose:function(refName){offEvents(),eval(refName+" = null;"),eval("delete "+refName+";")}}}}}();