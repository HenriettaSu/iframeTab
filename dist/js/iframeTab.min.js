!function(){iframeTab=jQuery.prototype={iframeHeight:function(a){var t=$(".active iframe")[0],e=$(document).frames?$(document).frames.iframepage.document:t.contentDocument;a?t.height=a:null!=t&&null!=e&&(t.height=e.body.scrollHeight)},init:function(a){var t=0,e=window.parent.document,n=$.extend({tabLiClass:"",tabPanClass:"",closesBtnClass:"fa fa-close",switchBtnDown:"fa fa-chevron-down",switchBtnUp:"fa fa-chevron-up",contextmenuClass:"dropdown open",iframeBox:'<div class="right_col" role="main"></div>',singleLineheight:92,menuWidth:230,callback:""},a),i=n.tabLiClass,o=n.tabPanClass,c=n.closesBtnClass,d=n.switchBtnDown,l=n.switchBtnUp,r=n.iframeBox,s=n.singleLineheight,m=n.menuWidth,h=n.contextmenuClass,f=n.callback;$.extend({btnDel:function(){$(document).on("click.tab.close",'.tabs-header li [data-btn="close"]',function(a){var t=$(this),e=t.parent(),n=e.data("tab"),i=e.data("num"),o=$(".tabs-header ul"),c=$(".tabs-header li"),d=$(".tabs-body"),l=e.prev(),r=e.next(),s=$(window).width(),h=0;e.remove(),d.find('iframe[data-iframe="'+n+'"][data-num="'+i+'"]').parent().parent().remove(),c.each(function(){var a=$(this),t=a.width()>0?a.width()+25:a.width();h+=t}),$('.tabs-header [data-btn="switch"]').length&&h<s-m&&($(".tabs-header").find('[data-btn="switch"]').remove(),$(document).off("click.tab.switch"),o.toggleClass("hide-tab"),o.width("auto")),"undefined"==typeof l.html()?r.click():l.click(),a.preventDefault(),a.stopPropagation()})},changeTab:function(){$(document).on("click.tab.change",".tabs-header li:not(.active)",function(){var a=$(this),t=a.data("tab"),e=a.data("num"),n=$(".tabs-header ul"),i=$(".tabs-header li"),o=$(".tabs-body"),c=$(".tab-panel"),d=o.find('iframe[data-iframe="'+t+'"][data-num="'+e+'"]');i.removeClass("active"),n.find('li[data-tab="'+t+'"][data-num="'+e+'"]').addClass("active"),c.removeClass("active"),d.parents(".tab-panel").addClass("active"),f.onChange&&f.onChange()})}}),$("[data-source]").length&&$(document).on("mouseup","[data-source]",function(){var a=$(this),t=a.data("source"),n=$(".tabs-body",e);n.find('iframe[src="'+t+'"]').attr("src",t),iframeTab.iframeHeight()}),$(document).on("mouseup","a[data-num]",function(a){function n(){var a,e,n=p.width();g.removeClass("active"),p.append('<li class="active '+i+'" data-tab="'+h+'" data-name="'+b+'" data-num="'+t+'">'+b+'<i class="'+c+'" data-btn="close"></i></li>'),!$('.tabs-header [data-btn="switch"]').length&&p.height()>s?(a=p.find("li:last-child"),p.width(n-30),p.addClass("hide-tab"),p.after('<i class="'+d+' fold-switch" data-btn="switch"></i>'),$(document).on("click.tab.switch",'.tabs-header [data-btn="switch"]',function(){var a=$(this);a.toggleClass(d),a.toggleClass(l),p.toggleClass("hide-tab")}),a.remove(),p.find("li:first-child").before(a)):$('.tabs-header [data-btn="switch"]').length&&(e=p.find("li:last-child"),e.remove(),p.find("li:first-child").before(e)),x.removeClass("active"),w.append(C),C.wrap('<div class="tab-panel active '+o+'"></div>'),C.wrap(r),t+=1,f.onCreat&&f.onCreat()}var m=$(this),h=m.attr("href"),b=m.attr("data-name")?m.data("name"):m.text(),u=m.data("mul"),v=m.data("reload"),p=$(".tabs-header ul",e),g=$(".tabs-header li",e),w=$(".tabs-body",e),x=$(".tab-panel",e),k=p.find('li[data-name="'+b+'"]').data("tab"),C=$('<iframe src="'+h+'" data-iframe="'+h+'" data-num="'+t+'" marginheight="0" marginwidth="0" frameborder="0" scrolling="no" onLoad="iframeTab.iframeHeight()" name="'+t+'"></iframe>');m.on("click",function(a){a.preventDefault(),a.stopPropagation()}),1===a.which&&($('.tabs-header li[data-name="'+b+'"]',e).length>0&&"undefined"==typeof u?!$('.tabs-header li[data-tab="'+h+'"]',e).length>0?(p.find('li[data-name="'+b+'"]').remove(),w.find('iframe[data-iframe="'+k+'"]').remove(),n()):(g.removeClass("active"),p.find('li[data-tab="'+h+'"]').addClass("active"),x.removeClass("active"),w.find('iframe[data-iframe="'+h+'"]').parents(".tab-panel").addClass("active"),"ja"===v&&w.find('iframe[data-iframe="'+h+'"]').attr("src",h)):n())}),1===$(".tabs-header li",e).length&&($.changeTab(),$.btnDel()),$(".tabs-header").on("mouseup",function(a){var t=$(this),e=a.clientX,n=a.clientY,i=window.innerWidth,o='<div class="tab-contextmenu '+h+'" style="top: '+n+'px"><ul class="dropdown-menu"><li><a href="javascript: void(0)" data-btn="removeAll">关闭所有标签</a></li><li><a href="javascript: void(0)" data-btn="removeExceptAct">关闭激活标签外所有标签</a></li></ul></div>',c=180;3===a.which&&(t.on("contextmenu",function(a){a.preventDefault()}),$(".tab-contextmenu").length&&$(".tab-contextmenu").remove(),$("body").before(o),i-e>c?$(".tab-contextmenu").css("left",e):$(".tab-contextmenu").css("right",c),$(document).on("click.context.remove.pl",'[data-btn="removeAll"]',function(){$(".tabs-header li:not(.tab-keep)").remove(),$(".tab-panel:not(.tab-keep)").remove(),$(".tabs-header li.tab-keep").click()}),$(document).on("click.context.remove.sing",'[data-btn="removeExceptAct"]',function(){$(".tabs-header li, .tab-panel").each(function(){var a=$(this);a.is(":not(.tab-keep)")&&a.is(":not(.active)")&&a.remove()}),$(".tabs-header li.active").click()}),$("body").on("click.hide.context",function(){$("body").off("click.hide.context"),$(".tab-contextmenu").remove(),$(document).off("click.context.remove.pl",'[data-btn="removeAll"]').off("click.context.remove.sing",'[data-btn="removeExceptAct"]')}),$(".tab-panel.active iframe")[0].contentWindow.$("body").on("click.hide.context",function(){$(".tab-panel.active iframe")[0].contentWindow.$("body").off("click.hide.context"),parent.$(".tab-contextmenu").remove(),parent.$(document).off("click.context.remove.pl",'[data-btn="removeAll"]').off("click.context.remove.sing",'[data-btn="removeExceptAct"]')}))}),$(document).on("click",'[data-btn="refresh"]',function(){window.location.reload(!0)})},closeActIframe:function(){parent.$('.tabs-header li.active [data-btn="close"]').click()}}}();