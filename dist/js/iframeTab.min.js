!function(){iframeTab=jQuery.prototype={iframeHeight:function(e){var a=$(".active iframe")[0],t=$(document).frames?$(document).frames.iframepage.document:a.contentDocument;e?a.height=e:null!=a&&null!=t&&(a.height=t.body.scrollHeight)},init:function(e){var a=0,t=window.parent.document,n=$.extend({tabLiClass:"",tabPanClass:"",closesBtnClass:"fa fa-close",switchBtnDown:"fa fa-chevron-down",switchBtnUp:"fa fa-chevron-up",contextmenuClass:"dropdown open",iframeBox:'<div class="right_col" role="main"></div>',singleLineheight:92,menuWidth:230,callback:""},e),i=n.tabLiClass,o=n.tabPanClass,r=n.closesBtnClass,c=n.switchBtnDown,d=n.switchBtnUp,l=n.iframeBox,s=n.singleLineheight,f=n.menuWidth,b=n.contextmenuClass,h=n.callback;if($.extend({btnDel:function(e){$(document).on("click.tab.close",'.tabs-header li [data-btn="close"]',function(a){var t,n=$(this),i=n.parent(),o=i.data("tab"),r=i.data("num"),c=$(".tabs-header ul"),d=$(".tabs-header li"),l=$(".tabs-body"),s=i.prev(),b=i.next(),h=$(window).width(),m=0;return t=e.beforeClose(),t!==!1&&(console.log(iframeTab),i.remove(),l.find('iframe[data-iframe="'+o+'"][data-num="'+r+'"]').parents(".tab-panel").remove(),d.each(function(){var e=$(this),a=e.width()>0?e.width()+25:e.width();m+=a}),$('.tabs-header [data-btn="switch"]').length&&m<h-f&&($(".tabs-header").find('[data-btn="switch"]').remove(),$(document).off("click.tab.switch"),c.toggleClass("hide-tab"),c.width("auto")),e.onClose(),"undefined"==typeof s.html()?b.click():s.click(),a.preventDefault(),a.stopPropagation(),void e.afterClose())})},changeTab:function(e){$(document).on("click.tab.change",".tabs-header li:not(.active)",function(){var a,t=$(this),n=t.data("tab"),i=t.data("num"),o=$(".tabs-header ul"),r=$(".tabs-header li"),c=$(".tabs-body"),d=$(".tab-panel"),l=c.find('iframe[data-iframe="'+n+'"][data-num="'+i+'"]');return a=e.beforeChange(),a!==!1&&(r.removeClass("active"),d.removeClass("active"),e.onChange(),o.find('li[data-tab="'+n+'"][data-num="'+i+'"]').addClass("active"),l.parents(".tab-panel").addClass("active"),void e.afterChange())})}}),$("[data-source]").length&&$(document).on("mouseup","[data-source]",function(){var e=$(this),a=e.data("source"),n=$(".tabs-body",t);n.find('iframe[src="'+a+'"]').attr("src",a),iframeTab.iframeHeight()}),$(document).on("mouseup","a[data-num]",function(e){function n(e){var t,n,f,h=p.width();return f=e.beforeCreat(),f!==!1&&(C.removeClass("active"),p.append('<li class="active '+i+'" data-tab="'+b+'" data-name="'+m+'" data-num="'+a+'">'+m+'<i class="'+r+'" data-btn="close"></i></li>'),!$('.tabs-header [data-btn="switch"]').length&&p.height()>s?(t=p.find("li:last-child"),p.width(h-30),p.addClass("hide-tab"),p.after('<i class="'+c+' fold-switch" data-btn="switch"></i>'),$(document).on("click.tab.switch",'.tabs-header [data-btn="switch"]',function(){var e=$(this);e.toggleClass(c),e.toggleClass(d),p.toggleClass("hide-tab")}),t.remove(),p.find("li:first-child").before(t)):$('.tabs-header [data-btn="switch"]').length&&(n=p.find("li:last-child"),n.remove(),p.find("li:first-child").before(n)),w.removeClass("active"),g.append(k),k.wrap('<div class="tab-panel active '+o+'"></div>'),k.wrap(l),e.onCreat(),$(k).load(function(){e.afterCreat()}),void(a+=1))}var f=$(this),b=f.attr("href"),m=f.attr("data-name")?f.data("name"):f.text(),u=f.data("mul"),v=f.data("reload"),p=$(".tabs-header ul",t),C=$(".tabs-header li",t),g=$(".tabs-body",t),w=$(".tab-panel",t),x=p.find('li[data-name="'+m+'"]').data("tab"),k=$('<iframe src="'+b+'" data-iframe="'+b+'" data-num="'+a+'" marginheight="0" marginwidth="0" frameborder="0" scrolling="no" onLoad="iframeTab.iframeHeight()" name="'+a+'"></iframe>');if(f.on("click",function(e){e.preventDefault(),e.stopPropagation()}),1===e.which){var y={beforeCreat:function(){if(h.beforeCreat)return h.beforeCreat()},onCreat:function(){h.onCreat&&h.onCreat()},afterCreat:function(){h.afterCreat&&h.afterCreat()}};$('.tabs-header li[data-name="'+m+'"]',t).length>0&&"undefined"==typeof u?!$('.tabs-header li[data-tab="'+b+'"]',t).length>0?(p.find('li[data-name="'+m+'"]').remove(),g.find('iframe[data-iframe="'+x+'"]').remove(),n(y)):(C.removeClass("active"),p.find('li[data-tab="'+b+'"]').addClass("active"),w.removeClass("active"),g.find('iframe[data-iframe="'+b+'"]').parents(".tab-panel").addClass("active"),"ja"===v&&g.find('iframe[data-iframe="'+b+'"]').attr("src",b)):n(y)}}),1===$(".tabs-header li",t).length){var m={beforeChange:function(){if(h.beforeChange)return h.beforeChange()},onChange:function(){h.onChange&&h.onChange()},afterChange:function(){h.afterChange&&h.afterChange()}},u={beforeClose:function(){if(h.beforeClose)return h.beforeClose()},onClose:function(){h.onClose&&h.onClose()},afterClose:function(){h.afterClose&&h.afterClose()}};$.changeTab(m),$.btnDel(u)}$(".tabs-header").on("mousedown",function(e){var a=$(this),t=e.clientX,n=e.clientY,i=window.innerWidth,o='<div class="tab-contextmenu '+b+'" style="top: '+n+'px"><ul class="dropdown-menu"><li><a href="javascript: void(0)" data-btn="removeAll">关闭所有标签</a></li><li><a href="javascript: void(0)" data-btn="removeExceptAct">关闭激活标签外所有标签</a></li></ul></div>',r=180;3===e.which&&(a.on("contextmenu",function(e){e.preventDefault()}),$(".tab-contextmenu").length&&$(".tab-contextmenu").remove(),$("body").before(o),i-t>r?$(".tab-contextmenu").css("left",t):$(".tab-contextmenu").css("right",r),$(document).on("click.context.remove.pl",'[data-btn="removeAll"]',function(){$(".tabs-header li:not(.tab-keep)").remove(),$(".tab-panel:not(.tab-keep)").remove(),$(".tabs-header li.tab-keep").click()}),$(document).on("click.context.remove.sing",'[data-btn="removeExceptAct"]',function(){$(".tabs-header li, .tab-panel").each(function(){var e=$(this);e.is(":not(.tab-keep)")&&e.is(":not(.active)")&&e.remove()}),$(".tabs-header li.active").click()}),$("body").on("click.hide.context",function(){$("body").off("click.hide.context"),$(".tab-contextmenu").remove(),$(document).off("click.context.remove.pl",'[data-btn="removeAll"]').off("click.context.remove.sing",'[data-btn="removeExceptAct"]')}),$(".tab-panel.active iframe")[0].contentWindow.$("body").on("click.hide.context",function(){$(".tab-panel.active iframe")[0].contentWindow.$("body").off("click.hide.context"),parent.$(".tab-contextmenu").remove(),parent.$(document).off("click.context.remove.pl",'[data-btn="removeAll"]').off("click.context.remove.sing",'[data-btn="removeExceptAct"]')}))}),$(document).on("click",'[data-btn="refresh"]',function(){window.location.reload(!0)})},closeActIframe:function(){parent.$('.tabs-header li.active [data-btn="close"]').click()}}}();